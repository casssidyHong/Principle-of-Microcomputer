ORG 0000H
AJMP MAIN
ORG 0050H
    
MAIN:
	MOV DPTR, #WORD //把要顯示的Table移到DPTR的位址
LOOP:
	//P2, P4都關掉(不顯示)
	MOV P2, #0FFH
	MOV 0C0H, #0FFH

	ACALL DISPLAY

	DEC R1
	DEC R1 
	//R1達到-96則重設成96
	CJNE R1, #0A0H, RESET
	MOV R1, #060H

RESET:
	ACALL DELAY //減少觸發次數
	AJMP LOOP

DISPLAY:
	JB P3.2, DSP //若不是紅外線感測到的期間則不執行
	MOV R0, #00H //counter歸0
	//把R1備份到R3
	MOV A, R1
	MOV R3, A

/* 目標:
   讓側邊亮 所以P0,P1不動 動P2,P4
   -> 兩個byte為一組
      第一個byte輸出給P2, 第二個byte給P4 */
DISPLAY1:
	//第一個byte輸出給P2R1給A
	MOV A, R1
	MOVC A, @A+DPTR;A到表取第A個值
	MOV P2, A
	INC R0 //counter ++

	//第二個byte輸出給P4
	INC R1 //R1+1
	MOV A, R1
	MOVC A, @A+DPTR 
	MOV 0C0H, A //0C0H = P4
	INC R0 //counter ++

	INC R1
	ACALL DELAY
	CJNE R0, #060H, DISPLAY1 //Table內容數值共有 8*4*3 = 96

//把前面備份的R1從R3移回去R1
DSP:
	MOV A, R3
	MOV R1, A
	RET

//延遲
DELAY:				
	MOV R5, #0AH
DELAY1:
	MOV R6, #028H
DELAY2:
	DJNZ R6, DELAY2
	DJNZ R5, DELAY1
	RET

//「別當我」table
WORD:
    DB  0FFH,07FH,0C1H,0BFH,0DDH,0CFH,05DH,0F0H
    DB  0DDH,0BDH,0DDH,07DH,0DDH,0BDH,0C1H,0C1H
    DB  0FFH,0FFH,0FFH,0FFH,007H,0F0H,0FFH,0BFH
    DB  0FFH,07FH,000H,080H,0FFH,0FFH,0FFH,0FFH

    DB  0DFH,0FFH,0E7H,0FFH,0F7H,003H,015H,0AAH
    DB  0D3H,0AAH,0D7H,0AAH,0D7H,0AAH,0D0H,082H
    DB  0D7H,0AAH,0D7H,0AAH,0D3H,0AAH,015H,0AAH
    DB  0F7H,003H,0D7H,0FFH,0E7H,0FFH,0FFH,0FFH

    DB  0DFH,0FFH,0DBH,0F7H,0DBH,0B7H,0DBH,07BH
    DB  001H,080H,0DCH,0FDH,0DDH,0BEH,0DFH,0BFH
    DB  0DFH,0DFH,000H,0ECH,0DFH,0F3H,0DDH,0EBH
    DB  0D3H,0DDH,05FH,0BEH,0DFH,007H,0FFH,0FFH
    
    END